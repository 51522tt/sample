<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/iview/css/iview.css">
    <title>样品库管理</title>
    <style>
        #table{padding: 32px;}
        html{
            height: 100%;
        }
        .demo-drawer-profile{
            font-size: 14px;
        }
        .demo-drawer-profile .ivu-col{
            margin-bottom: 12px;
        }
        .demo-spin-icon-load{
            animation: ani-demo-spin 1s linear infinite;
        }
        @keyframes ani-demo-spin {
            from { transform: rotate(0deg);}
            50%  { transform: rotate(180deg);}
            to   { transform: rotate(360deg);}
        }
        .demo-spin-col{
            height: 100px;
            position: relative;
            border: 1px solid #eee;
        }


        .layout{
            border: 1px solid #d7dde4;
            background: #f5f7f9;
            position: relative;
            border-radius: 4px;
            overflow: hidden;
        }
        .layout-header-bar{
            background: #fff;
            box-shadow: 0 1px 1px rgba(0,0,0,.1);
        }
        .menu-item span{
            display: inline-block;
            overflow: hidden;
            width: 69px;
            text-overflow: ellipsis;
            white-space: nowrap;
            vertical-align: bottom;
            transition: width .2s ease .2s;
        }
        .menu-item i{
            transform: translateX(0px);
            transition: font-size .2s ease, transform .2s ease;
            vertical-align: middle;
            font-size: 16px;
        }
        .collapsed-menu span{
            width: 0px;
            transition: width .2s ease;
        }
        .collapsed-menu i{
            transform: translateX(5px);
            transition: font-size .2s ease .2s, transform .2s ease .2s;
            vertical-align: middle;
            font-size: 22px;
        }

        .layout-logo{
            width: 115px;
            height: 40px;
            background: #5b6270;
            border-radius: 3px;
            float: right;
            position: relative;
            top: 10px;
            right: 50px;
        }

        .info{
            float: right;
            width: 60px;
            position: relative;
            top:18px;
            right: -53px;
            border-radius: 3px;
        }
        .logout{
            float: right;
            position: relative;
            top: 10px;
            right: -173px;
            height: 40px;
            border:none;
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="layout">
            <layout collapsible>
                <sider ref="side1" hide-trigger collapsible :collapsed-width="78" v-model="isCollapsed">
                    <i-menu :active-name="activeName" theme="dark" width="auto" :class="menuitemClasses">
                        <menu-item name="newSample" @click.native="showCom('newSample')">
                            <icon type="ios-navigate"></icon>
                            <span>新到样品</span>
                        </menu-item>
                        <menu-item name="sample" @click.native="showCom('sample')">
                            <icon type="ios-search"></icon>
                            <span>已到样品</span>
                        </menu-item>
                        <menu-item name="newPaySample" @click.native="showCom('newPaySample')">
                            <icon type="ios-search"></icon>
                            <span>新购样品</span>
                        </menu-item>
                        <menu-item name="reportAnalysis" @click.native="showCom('reportAnalysis')"  th:if="${session.user.level == 1}">
                            <icon type="md-list-box"></icon>
                            <span>报表分析</span>
                        </menu-item>
                    </i-menu>
                </sider>

                <layout>
                    <i-header :style="{padding: 0}" class="layout-header-bar">
                        <icon @click.native="collapsedSider" :class="rotateIcon" :style="{margin: '0 20px'}" type="md-menu"
                            size="24"></icon>
                        <date-picker type="datetimerange" format="yyyy-MM-dd HH:mm" v-model="lect" placeholder="选择时间范围" style="width: 300px"></date-picker>
                        <auto-complete
                                v-model="value3"
                                :data="data3"
                                icon="ios-search"
                                placeholder="模糊查询"
                                style="margin-left:10px;width:300px"
                                @on-change="searchChange"
                                @on-select="selectValue"
                                placement="bottom"
                        >

                        </auto-complete>
                        <div class="layout-logo">
                            <avatar src="/img/logo.png" style="position: absolute;top: 4px;left: 4px;" />
                        </div>
                        <i-button @click="value = true" size="small" type="default" class="info" th:text="${session.user.getUsername()}"></i-button>
                        <i-button size="small" type="default" class="logout" @click="logout">
                            <icon type="md-log-out" style="color:#ed4014" size="30" />
                        </i-button>
                    </i-header>

                    <i-content :style="{margin: '20px', background: '#fff', minHeight: '800px'}">
                        <component :is="currentTabComponent" class="tab" :lect="lect" :value3="value3"></component>
                    </i-content>
                </layout>
            </layout>
        </div>
        <div>
            <drawer :closable="false" width="640" v-model="value" placement="left">
                <p :style="pStyle">User Profile</p>
                <p :style="pStyle">Personal</p>
                <div class="demo-drawer-profile">
                    <row>
                        <i-col span="12">
                            Full Name: Aresn
                        </i-col>
                        <i-col span="12">
                            Account: aresn@aresn.com
                        </i-col>
                    </row>
                    <row>
                        <i-col span="12">
                            City: BeiJing
                        </i-col>
                        <i-col span="12">
                            Country: China
                        </i-col>
                    </row>
                    <row>
                        <i-col span="12">
                            Birthday: May 14, 1991
                        </i-col>
                        <i-col span="12">
                            Website: <a href="https://dev.iviewui.com" target="_blank">https://dev.iviewui.com</a>
                        </i-col>
                    </row>
                    Message: Hello, Developer
                </div>
                <divider />
            </drawer>
        </div>
    </div>
    <script src="/vue/vue.js"></script>
    <script src="/iview/js/iview.js"></script>
    <script src="/axios/axios.min.js"></script>
    <script src="/echarts/echarts.js"></script>
    <script th:inline="javascript">
        Date.prototype.Format = function (fmt) { //author: meizz
            var o = {  "M+": this.getMonth() + 1, //月份
                "d+": this.getDate(), //日
                "H+": this.getHours(), //小时
                "m+": this.getMinutes(), //分
                "s+": this.getSeconds(), //秒
                "q+": Math.floor((this.getMonth() + 3) / 3), //季度
                "S": this.getMilliseconds() //毫秒
            };
            if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
            for (var k in o)
                if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
            return fmt;
        };
        Vue.component('tab-newSample', {
            props:{
                lect: {
                    type: Array,
                    default: []
                },
                value3: {
                    type: String,
                    default: ''
                }
            },
            data: function () {
                return {
                    dataSum: null,
                    pageNum: 0,
                    pageSize: 20,
                    columns: [
                        {
                            title:'FNSKU',
                            key:'fnsku'
                        },
                        {
                            title:'图片',
                            key:'img',
                            render: (h, params) => {
                                return h('img', {
                                        attrs: {
                                            src: params.row.img, style: 'width:100px'
                                        }
                                    })
                            }
                        }
                        ,
                        {
                            title: 'ASIN',
                            key: 'asin',
                            render: (h, params) => {
                                return h('div', [
                                    h('icon', {
                                        props: {
                                            type: 'person'
                                        }
                                    }),
                                    h('strong', params.row.asin)
                                ]);
                            }
                        },
                        {
                            title: 'SKU',
                            key: 'sku'
                        },
                        {
                            title: '名称',
                            key: 'name',
                            filters:null,
                            filterMethod (value, row) {
                                return row.name.indexOf(value) > -1;
                            }
                        },
                        {
                            title: '时间',
                            key: 'dateTime',
                        },
                        {
                            title: '存放位置',
                            key: 'location',
                            render: (h,params) => {
                                return h('i-input',{
                                    props:{
                                        required:'required',
                                        vModel: 'value8',
                                        type: 'textarea',
                                        placeholder: '输入存放位置'
                                    },
                                    style: {
                                        width:'100%',
                                        height:'100%',
                                        marginRight: '5px'
                                    },
                                    on: {
                                        input: (v) => params.row.location = v
                                    }
                                })
                            }
                        },
                        {
                            title: '操作',
                            key: 'action',
                            width: 150,
                            align: 'center',
                            render: (h, params) => {
                                return h('div', [
                                    h('Button', {
                                        props: {
                                            type: 'primary',
                                            size: 'small'
                                        },
                                        style: {
                                            marginRight: '5px'
                                        },
                                        on: {
                                            click: () => {
                                                this.show(params.index)
                                            }
                                        }
                                    }, '查看'),
                                    h('Button', {
                                        props: {
                                            type: 'error',
                                            size: 'small'
                                        },
                                        on: {
                                            click: () => {
                                                this.remove(params.index, params.row)
                                            }
                                        }
                                    }, '确认')
                                ]);
                            }
                        }
                    ],
                    data: []
                }
            },
            methods: {
                show(index) {
                    this.$Modal.info({
                        title: 'sample Info',
                        content: `fnsku：${this.data[index].fnsku}<br>asin：${this.data[index].asin}<br>sku：${this.data[index].sku}<br>name：${this.data[index].name}<br>扫描时间：${this.data[index].dateTime}`
                    })
                },
                remove(index, sample) {
                    console.log(JSON.stringify(sample,null,4))

                    if(sample.location == null){
                        this.$Notice.error({
                            title: '存放位置不能为空,请填写位置描述！！！'
                            //desc: nodesc ? '' : 'Here is the notification description. Here is the notification description. '
                        });
                        return ;
                    }
                    this.dataSum -=1;
                    new Promise((resolve, reject) => {
                            axios.delete('/sample/data/newsample', {
                                params: sample
                            }).then(response => {
                                resolve(response)
                            })
                        })
                        .then(response => {

                        }).catch(err => {});

                    this.data.splice(index, 1);
                },
                getNewSample(page, size) {
                    var vue = this;
                    axios.get('/sample/data/findNewSampleNoQuery', {
                            params: {
                                page: page,
                                size: size,
                                start:typeof(vue.$props.lect[0]) == 'string' ? "":vue.$props.lect[0].Format("yyyy-MM-dd HH:mm:ss"),
                                end:typeof(vue.$props.lect[1]) == 'string' ? "":vue.$props.lect[1].Format("yyyy-MM-dd HH:mm:ss")
                            }
                        })
                        .then(function (response) {
                            vue.data = response.data.samples;
                            var filter = [];
                            var isPush = false;
                            vue.data.forEach((index,i) => {
                                index.img = `http://img.manage.com/amimages/${index.sku}/400_400/1.jpg`
                                for(var a = 0 ; a<filter.length || filter.length==0 ; a++) {
                                    if(filter.length != 0){
                                        if(index.name === filter[a].label){
                                            isPush = false;
                                            break;
                                        }
                                    }else{
                                        filter[0]={
                                            label: index.name,
                                            value: index.name
                                        }
                                    }
                                }
                                if(isPush){
                                    filter[filter.length]={
                                        label: index.name,
                                        value: index.name
                                    }
                                }
                                isPush = true;

                            })
                            vue.columns[4].filters = filter
                            vue.dataSum = response.data.dataItems;
                        })
                        .catch(function (error) {
                            console.log(error);
                        });
                },
                currentPage(index) {
                    this.pageNum = index - 1;
                    this.getNewSample(index - 1, this.pageSize);
                },
                pageData(data) {
                    this.pageSize = data
                    this.getNewSample(this.pageNum, data)
                }

            },
            created() {
                this.getNewSample(this.pageNum, this.pageSize)
            },
            watch: {
                lect () {
                    this.getNewSample(this.pageNum, this.pageSize)
                },
                value3(){
                    var vue = this;
                    if(vue.$props.value3 === ""){
                        this.getNewSample(this.pageNum, this.pageSize)
                        return
                    }
                    axios.get('/sample/data/vagueQueryNewSamples', {
                        params: {
                            page: vue.pageNum,
                            size: vue.pageSize,
                            q:vue.$props.value3,
                            start:typeof(vue.$props.lect[0]) == 'string' ? "":vue.$props.lect[0].Format("yyyy-MM-dd HH:mm:ss"),
                            end:typeof(vue.$props.lect[1]) == 'string' ? "":vue.$props.lect[1].Format("yyyy-MM-dd HH:mm:ss")
                        }
                    })
                        .then(function (response) {
                            //console.log(vue.$props.lect)
                            vue.data = response.data.samples
                            var filter = [];
                            var isPush = false;
                            vue.data.forEach((index,i) => {
                                index.img = `http://img.manage.com/amimages/${index.sku}/400_400/1.jpg`
                                for(var a = 0 ; a<filter.length || filter.length==0 ; a++) {
                                    if(filter.length != 0){
                                        if(index.name === filter[a].label){
                                            isPush = false;
                                            break;
                                        }
                                    }else{
                                        filter[0]={
                                            label: index.name,
                                            value: index.name
                                        }
                                    }
                                }
                                if(isPush){
                                    filter[filter.length]={
                                        label: index.name,
                                        value: index.name
                                    }
                                }
                                isPush = true;
                            })

                            vue.columns[2].filters = filter
                            //console.log(response.data.dataItems)
                            vue.dataSum = response.data.dataItems
                        })
                        .catch(function (error) {
                            console.log(error);
                        });

                }
            },
            template: '<div id="table" style="min-height: 200px;">' +
                '<i-table border :columns="columns"   :data="data"></i-table><page :total="dataSum" :page-size-opts="[10,20,30,40,50,60,70,80,100]" :page-size="pageSize" size="small" show-elevator show-sizer style="margin-top: 10px;" @on-change="currentPage" @on-page-size-change="pageData"/><div>总数：{{dataSum}}</div>' +
                '</div>'
        })
        Vue.component('tab-sample', {
            props:{
                scroll:{
                  type:Number,
                  default:0
                },
                lect: {
                    type: Array,
                    default: []
                },
                value3: {
                    type: String,
                    default: ''
                }
            },
            data: function () {
                return {
                    title:"",
                    currentSamples:[],
                    split:0.5,
                    dataSum: null,
                    pageNum: 0,
                    pageSize: 20,
                    columns: [
                        {
                            title:'ASIN',
                            key:'asin'
                        },
                        {
                            title:'图片',
                            key:'img',
                            render: (h, params) => {
                                return h('img', {
                                    attrs: {
                                        src: params.row.img, style: 'width:100px'
                                    }
                                })
                            }
                        },
                        {
                            title: '名称',
                            key: 'name',
                            filters:null,
                            filterMethod (value, row) {
                                return row.name.indexOf(value) > -1;
                            }
                        }
                    ],
                    data: []
                }
            },
            methods: {
                showData(row,index){
                    this.title=row.asin
                    this.getSampleByAsin(row.asin)
                    //this.$Message.info(`${JSON.stringify(row,null,4)}+${index}`);
                },
                getSampleByAsin(asin){
                    var vue = this;
                    axios.get('/sample/data/findSampleByAsin', {
                        params: {
                            asin:asin,
                            start:typeof(vue.$props.lect[0]) == 'string' ? "":vue.$props.lect[0].Format("yyyy-MM-dd HH:mm:ss"),
                            end:typeof(vue.$props.lect[1]) == 'string' ? "":vue.$props.lect[1].Format("yyyy-MM-dd HH:mm:ss")
                        }
                    })
                        .then(function (response) {
                            vue.currentSamples = response.data.samples
                        })
                        .catch(function (error) {
                            console.log(error);
                        });
                },
                getSample(page, size) {
                    var vue = this;
                    axios.get('/sample/data/findSampleNoQuery', {
                            params: {
                                page: page,
                                size: size,
                                start:typeof(vue.$props.lect[0]) == 'string' ? "":vue.$props.lect[0].Format("yyyy-MM-dd HH:mm:ss"),
                                end:typeof(vue.$props.lect[1]) == 'string' ? "":vue.$props.lect[1].Format("yyyy-MM-dd HH:mm:ss")
                            }
                        })
                        .then(function (response) {
                            //console.log(vue.$props.lect)
                            vue.data = response.data.samples
                            var filter = [];
                            var isPush = false;
                            vue.data.forEach((index,i) => {
                                index.img = `http://img.manage.com/amimages/${index.sku}/400_400/1.jpg`
                                for(var a = 0 ; a<filter.length || filter.length==0 ; a++) {
                                    if(filter.length != 0){
                                        if(index.name === filter[a].label){
                                            isPush = false;
                                            break;
                                        }
                                    }else{
                                        filter[0]={
                                            label: index.name,
                                            value: index.name
                                        }
                                    }
                                }
                                if(isPush){
                                    filter[filter.length]={
                                        label: index.name,
                                        value: index.name
                                    }
                                }
                                isPush = true;
                            })

                            vue.columns[2].filters = filter
                            //console.log(response.data.dataItems)
                            vue.dataSum = response.data.dataItems
                        })
                        .catch(function (error) {
                            console.log(error);
                        });
                },
                currentPage(index) {
                    this.pageNum = index - 1;
                    console.log(`${this.pageNum} + ${this.pageSize}`)
                    this.getSample(index - 1, this.pageSize)
                },
                pageData(data) {
                    this.pageSize = data
                    this.getSample(this.pageNum, data)
                },
                winScroll(){
                    var scroll = document.documentElement.scrollTop
                    var el = this.$refs.myel;
                    console.log(this.$refs.myel)
                    var elStyle = el.$el.style
                    if(scroll > 100){
                        elStyle.marginTop =  (scroll - 100)+30+'px'
                    }else{
                        elStyle.marginTop = 30+'px'
                    }
                }
            },
            created() {
                this.getSample(this.pageNum, this.pageSize)
                document.addEventListener('scroll',this.winScroll,false);
            },
            mounted(){
                // var viewportOffset  = el.getBoundingClientRect();
                // console.log(`${viewportOffset.top} + ${viewportOffset.left}`)
                console.log(this.$refs.myel)
            }
            ,
            watch: {
                lect () {
                    this.getSample(this.pageNum, this.pageSize)
                },
                value3(){
                    var vue = this;
                    if(vue.$props.value3 === ""){
                        this.getSample(this.pageNum, this.pageSize)
                        return
                    }
                    axios.get('/sample/data/vagueQuerySample', {
                        params: {
                            page: vue.pageNum,
                            size: vue.pageSize,
                            q:vue.$props.value3,
                            start:typeof(vue.$props.lect[0]) == 'string' ? "":vue.$props.lect[0].Format("yyyy-MM-dd HH:mm:ss"),
                            end:typeof(vue.$props.lect[1]) == 'string' ? "":vue.$props.lect[1].Format("yyyy-MM-dd HH:mm:ss")
                        }
                    })
                        .then(function (response) {
                            //console.log(vue.$props.lect)
                            vue.data = response.data.samples
                            var filter = [];
                            var isPush = false;
                            vue.data.forEach((index,i) => {
                                index.img = `http://img.manage.com/amimages/${index.sku}/400_400/1.jpg`
                                for(var a = 0 ; a<filter.length || filter.length==0 ; a++) {
                                    if(filter.length != 0){
                                        if(index.name === filter[a].label){
                                            isPush = false;
                                            break;
                                        }
                                    }else{
                                        filter[0]={
                                            label: index.name,
                                            value: index.name
                                        }
                                    }
                                }
                                if(isPush){
                                    filter[filter.length]={
                                        label: index.name,
                                        value: index.name
                                    }
                                }
                                isPush = true;
                            })

                            vue.columns[2].filters = filter
                            //console.log(response.data.dataItems)
                            vue.dataSum = response.data.dataItems
                        })
                        .catch(function (error) {
                            console.log(error);
                        });

                }
            },
            // language=HTML
            template: `
                    <row>
                        <i-col span="12">
                            <div id="table" style="min-height: 200px;">
                                <i-table border :columns="columns"  :data="data" highlight-row @on-row-click="showData"></i-table>
                                <page :total="dataSum" :page-size="pageSize" :page-size-opts="[10,20,30,40,50,60,70,80,100]" size="small" show-elevator show-sizer style="margin-top: 10px;" @on-change="currentPage" @on-page-size-change="pageData"/><div>总数：{{dataSum}}</div>
                            </div>
                        </i-col>
                        <i-col span="12">
                             <card style="margin-top:30px;margin-right: 30px;" dis-hover  ref="myel" >
                                <p slot="title">{{title}}</p>
                                <p>
                                    <row >
                                        <i-col span="6" style="font-weight:bold;text-align: center">FNSKU</i-col>
                                        <i-col span="6" style="font-weight:bold;text-align: center">SKU</i-col>
                                        <i-col span="6" style="font-weight:bold;text-align: center"">时间</i-col>
                                        <i-col span="6" style="font-weight:bold;text-align: center"">位置</i-col>
                                    </row>
                                    <row v-for="samples in currentSamples">
                                        <i-col span="6" style="text-align: center">{{samples.fnsku}}</i-col>
                                        <i-col span="6" style="text-align: center">{{samples.sku}}</i-col>
                                        <i-col span="6" style="text-align: center">{{new Date(samples.dateTime).Format("yyyy-MM-dd HH:mm:ss")}}</i-col>
                                        <i-col span="6" style="text-align: center">{{samples.location}}</i-col>
                                    </row>
                                </p>

                            </card>
                        </i-col>
                    </row>
            `
        });
        Vue.component('tab-newPaySample', {
            props:{
                lect: {
                    type: Array,
                    default: []
                },
                value3: {
                    type: String,
                    default: ''
                }
            },
            data: function () {
                return {
                    formItem:{
                        productName:'',
                        orderNumber:'',
                        imgPath:'',
                        number:0,
                        money:0,
                        url:'',
                        lecDateTime:'',
                        location:'',
                    },
                    ruleInline: {
                        productName: [
                            { required: true, message: '请输入样品名称.', trigger: 'blur' }
                        ],
                        orderNumber: [
                            { required: true, message: '请输入订单号.', trigger: 'blur' },
                            { type: 'string', min: 6, message: 'The password length cannot be less than 6 bits', trigger: 'blur' }
                        ],
                        number: [
                            { required: true, message: '请输入数量.', trigger: 'blur' },
                        ],
                        money: [
                            { required: true, message: '请输入金额.', trigger: 'blur' },
                        ],
                        url: [
                            { required: true, message: '请输入链接.', trigger: 'blur' },
                        ],
                        location: [
                            { required: true, message: '请输入存放位置.', trigger: 'blur' },
                        ],
                    },
                    modal: false,
                    modal_loading: false,
                    dataSum: null,
                    pageNum: 0,
                    pageSize: 20,
                    columns: [
                        {
                            title:'产品名称',
                            key:'productName'
                        },
                        {
                            title: '订单号',
                            key: 'orderNumber'
                        },
                        {
                            title:'图片',
                            key:'imgPath',
                            render: (h, params) => {
                                return h('img', {
                                    attrs: {
                                        src: params.row.img, style: 'width:100px'
                                    }
                                })
                            }
                        }
                        ,
                        {
                            title: '数量',
                            key: 'number'
                        },
                        {
                            title: '金额',
                            key: 'money'
                        },
                        {
                            title: '链接',
                            key: 'url'
                        },
                        {
                            title: '收录时间',
                            key: 'lecDateTime'
                        },
                        {
                            title: '存放位置',
                            key: 'location',
                            render: (h,params) => {
                                return h('i-input',{
                                    props:{
                                        required:'required',
                                        vModel: 'value8',
                                        type: 'textarea',
                                        placeholder: '输入存放位置'
                                    },
                                    style: {
                                        width:'100%',
                                        height:'100%',
                                        marginRight: '5px'
                                    },
                                    on: {
                                        input: (v) => params.row.location = v
                                    }
                                })
                            }
                        }
                    ],
                    data: []
                }
            },
            methods: {
                getNewPaySample(page, size) {
                    var vue = this;
                    axios.get('/sample/data/newPaySample', {
                        params: {
                            page: page,
                            size: size,
                            start:typeof(vue.$props.lect[0]) == 'string' ? "":vue.$props.lect[0].Format("yyyy-MM-dd HH:mm:ss"),
                            end:typeof(vue.$props.lect[1]) == 'string' ? "":vue.$props.lect[1].Format("yyyy-MM-dd HH:mm:ss")
                        }
                    })
                        .then(function (response) {
                            vue.data = response.data.samples;
                            var filter = [];
                            var isPush = false;
                            vue.data.forEach((index,i) => {
                                index.img = `http://img.manage.com/amimages/${index.sku}/400_400/1.jpg`
                                for(var a = 0 ; a<filter.length || filter.length==0 ; a++) {
                                    if(filter.length != 0){
                                        if(index.name === filter[a].label){
                                            isPush = false;
                                            break;
                                        }
                                    }else{
                                        filter[0]={
                                            label: index.name,
                                            value: index.name
                                        }
                                    }
                                }
                                if(isPush){
                                    filter[filter.length]={
                                        label: index.name,
                                        value: index.name
                                    }
                                }
                                isPush = true;

                            })
                            vue.columns[4].filters = filter
                            vue.dataSum = response.data.dataItems;
                        })
                        .catch(function (error) {
                            console.log(error);
                        });
                },
                currentPage(index) {
                    this.pageNum = index - 1;
                    this.getNewPaySample(index - 1, this.pageSize);
                },
                pageData(data) {
                    this.pageSize = data
                    this.getNewPaySample(this.pageNum, data)
                },
                del () {
                    var vm = this;
                    console.log("aaa")
                    // this.$refs['formItem'].validate((valid) => {
                    //     console.log('bbbb')
                    //     if (!valid) {
                    //         vm.$Message.error('失败！');
                    //     }else{
                    //         vm.modal_loading = true;
                    //         setTimeout(() => {
                    //             vm.modal_loading = false;
                    //             vm.modal = false;
                    //             vm.$Message.success('添加成功');
                    //         }, 2000);
                    //     }
                    // })
                    setTimeout(() => {
                                        vm.modal_loading = false;
                                        vm.modal = false;
                                        vm.$Message.success('添加成功');
                                    }, 2000);
                },
                handleSubmit(name) {

                }
            },
            created() {
                this.getNewPaySample(this.pageNum, this.pageSize)
            },
            watch: {
                lect () {
                    this.getNewPaySample(this.pageNum, this.pageSize)
                },
                value3(){
                    var vue = this;
                    if(vue.$props.value3 === ""){
                        this.getNewPaySample(this.pageNum, this.pageSize)
                        return
                    }
                    axios.get('/sample/data/newPaySample', {
                        params: {
                            page: vue.pageNum,
                            size: vue.pageSize,
                            start:typeof(vue.$props.lect[0]) === 'string' ? "":vue.$props.lect[0].Format("yyyy-MM-dd HH:mm:ss"),
                            end:typeof(vue.$props.lect[1]) === 'string' ? "":vue.$props.lect[1].Format("yyyy-MM-dd HH:mm:ss")
                        }
                    })
                        .then(function (response) {
                            //console.log(vue.$props.lect)
                            vue.data = response.data.samples;
                            var filter = [];
                            var isPush = false;
                            vue.data.forEach((index,i) => {
                                index.img = `http://img.manage.com/amimages/${index.sku}/400_400/1.jpg`;
                                for(var a = 0 ; a<filter.length || filter.length===0 ; a++) {
                                    if(filter.length !== 0){
                                        if(index.name === filter[a].label){
                                            isPush = false;
                                            break;
                                        }
                                    }else{
                                        filter[0]={
                                            label: index.name,
                                            value: index.name
                                        }
                                    }
                                }
                                if(isPush){
                                    filter[filter.length]={
                                        label: index.name,
                                        value: index.name
                                    }
                                }
                                isPush = true;
                            })

                            vue.columns[2].filters = filter
                            //console.log(response.data.dataItems)
                            vue.dataSum = response.data.dataItems
                        })
                        .catch(function (error) {
                            console.log(error);
                        });

                }
            },
            template: `<div id="table" style="min-height: 200px;">
                            <i-button type="success" shape="circle" icon="md-add" @click="modal = true">新购样品</i-button>
                            <divider orientation="left"></divider>
                            <i-table border :columns="columns"   :data="data"></i-table>
                            <page :total="dataSum"
                                  :page-size-opts="[10,20,30,40,50,60,70,80,100]"
                                  :page-size="pageSize" size="small"
                                  show-elevator
                                  show-sizer
                                  style="margin-top: 10px;"
                                  @on-change="currentPage"
                                  @on-page-size-change="pageData"/>
                            <div>总数：{{dataSum}}</div>

                         <modal v-model="modal" width="360">
                            <p slot="header" style="color:#f60;text-align:center">
                                <icon type="ios-information-circle"></icon>
                                <span>请填写新购样品信息</span>
                            </p>
                            <div style="text-align:center">
                                <i-form :model="formItem" ref="formItem" :rules="ruleInline"
                                :label-width="80">
                                    <row>
                                        <i-col span="24">
                                            <form-item label="样品名称">
                                                <i-input v-model="formItem.productName" placeholder="请输入样品名称..."></i-input>
                                            </form-item>
                                        </i-col>
                                    </row>
                                    <row>
                                        <i-col span="24">
                                            <form-item label="订单号">
                                                <i-input v-model="formItem.orderNumber" placeholder="请输入订单号..."></i-input>
                                            </form-item>
                                        </i-col>
                                    </row>
                                    <row>
                                        <i-col span="12">
                                            <form-item label="数量">
                                               <input-number :max="10" :min="1" v-model="formItem.number"></input-number>
                                            </form-item>
                                        </i-col>
                                        <i-col span="12">
                                            <form-item label="金额">
                                                <input-number  :max="10000" v-model="formItem.money" ></input-number>
                                            </form-item>
                                        </i-col>
                                    </row>
                                    <row>
                                        <i-col span="24">
                                            <form-item label="链接">
                                                <i-input v-model="formItem.url" placeholder="请输入链接..."></i-input>
                                            </form-item>
                                        </i-col>
                                    </row>
                                    <row>
                                        <i-col span="24">
                                            <form-item label="存放位置">
                                               <i-input v-model="formItem.location" type="textarea" :autosize="{minRows: 2,maxRows: 5}" placeholder="存放位置"/>
                                            </form-item>
                                        </i-col>
                                    </row>
                               </i-form>
                            </div>
                            <div slot="footer">
                                <i-button type="error" size="large" long :loading="modal_loading" @click="del()" >添加</i-button>
                            </div>
                        </modal>
                        </div>

                    `
        });
        Vue.component('tab-reportAnalysis', {
            data() {
                return {
                    spinShow:true,
                    speciesNumber: [],
                    total:[],
                    accounts:[],
                    users:[]
                }
            },
            methods:{
                draw(){
                    var category=this.users;
                    var option = {
                        title: {
                            text: '数量统计'
                        },
                        tooltip: {trigger: 'axis',
                            axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                                type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                            }},
                        grid: {
                            left: '3%',
                            right: '4%',
                            bottom: '3%',
                            containLabel: true
                        },
                        legend: {
                            data:['账户数','样品数','样品总个数']
                        },
                        xAxis: {
                            data: category
                        },
                        yAxis: {},
                        series: [
                            {
                                name: '账户数',
                                type: 'bar',
                                data: this.accounts
                            },
                            {
                            name: '样品数',
                            type: 'bar',
                            data: this.speciesNumber   //数据绑定
                            },
                            {
                                name: '样品总个数',
                                type: 'bar',
                                data: this.total
                            }

                        ]
                    }
                    this.myChart.setOption(option);
                }
                ,
                getInfoMap(){
                    var vue = this;
                    axios.get('/sample/data/findInfo')
                        .then(function (response) {
                            response.data.users.forEach((index,i)=>{
                                vue.speciesNumber[i]=response.data.users[i].speciesNumber == null?0:response.data.users[i].speciesNumber;
                                vue.total[i]=response.data.users[i].total  == null?0:response.data.users[i].total;
                                vue.accounts[i]=response.data.users[i].accounts == null?0:response.data.users[i].accounts
                                vue.users[i]=response.data.users[i].username == null?0:response.data.users[i].username;
                            })
                            vue.spinShow=false
                            vue.draw();
                            //console.log(JSON.stringify(response.data,null,4));
                        })
                        .catch(function (err) {
                            vue.$Message.error(
                            {
                                content: `发生了一个预料之中的错误!<br>可以尝试<a>刷新</a>页面,但不要联系管理员!`,
                                duration: 20
                            }
                            );

                            console.log(err);
                        });
                }
            },
            created(){
                this.getInfoMap()
            }
            ,
            mounted(){
                this.$nextTick(function() {
                    this.myChart = echarts.init(document.getElementById('main'));  //初始化echarts实例
                    this.draw();
                })
            },
            template: `
                            <card style="margin-top: 30px;margin-right: 30px;margin-left: 30px" dis-hover>
                                    <spin fix v-if="spinShow">
                                        <icon type="ios-loading" size=18 class="demo-spin-icon-load"></icon>
                                        <div>Loading</div>
                                    </spin>

                                <p slot="title">统计</p>
                                <div id="main" style="width: 600px;height:400px;">

                                </div>
                            </div>
                            </card>
                       `
        });

        var vm = new Vue({
            el: "#app",
            data: {
                selectData:[],
                value: false,
                value3: '',
                data3: [],
                accounts: [
                    [[${session.accounts}]]
                ],
                lect:[],
                pStyle: {
                    fontSize: '16px',
                    color: 'rgba(0,0,0,0.85)',
                    lineHeight: '24px',
                    display: 'block',
                    marginBottom: '16px'
                },
                currentTab: "newSample",
                activeName: '',
                isCollapsed: false
            },
            computed: {
                rotateIcon() {
                    return [
                        'menu-icon',
                        this.isCollapsed ? 'rotate-icon' : ''
                    ];
                },
                menuitemClasses() {
                    return [ [[${session.accounts}]],
                        'menu-item',
                        this.isCollapsed ? 'collapsed-menu' : ''
                    ]
                },
                currentTabComponent: function () {
                    return 'tab-' + this.currentTab
                }
            },
            methods: {
                filterMethod (value, option) {
                    return option.toUpperCase().indexOf(value.toUpperCase()) !== -1;
                },
                collapsedSider() {
                    this.$refs.side1.toggleCollapse();
                },
                showCom(currentTab) {
                    this.currentTab = currentTab;
                    this.activeName = currentTab;
                },
                logout() {
                    axios.delete("/sample/data").then(res => {
                        location.replace("/");
                    })
                },
                searchChange(value){
                    var vue = this;
                    if(value === ""){
                        vue.data3 = []
                        return;
                    }
                    // axios.get("/sample/data/vagueQuery",{
                    //    params:{
                    //        value:value
                    //         }
                    //     }).then(res => {
                    //         console.log(JSON.stringify(res.data,null,4))
                    //         var a= []
                    //         res.data.samples.forEach( (samples,index) =>{
                    //             a[index] = `${samples.fnsku}  ${samples.asin}  ${samples.sku}  ${samples.name}  ${samples.dateTime}`
                    //         })
                    //         vue.data3 = a
                    //     })


                },
                selectValue(value){
                }

            },
            created() {
                this.activeName = 'newSample'
            }
        })
    </script>
</body>

</html>